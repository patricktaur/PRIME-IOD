<app-loader [isLoading]="loading"></app-loader>
<h5>{{ title }}</h5>
<hr />
<div class="row" *ngIf="displayUserSelectDropDown">
  <div class="col-3">
    User:
  </div>
  <div class="col-9">
    <ng-select
      id="exampleFormControlSelect1"
      [multiple]="false"
      [clearable]="false"
      [(ngModel)]="selecteduserId"
      (ngModelChange)="onFiltersChange($event)"
    >
      <ng-option *ngFor="let rec of users" [value]="rec.id">{{ rec.value }}</ng-option>
    </ng-select>
    <div class="alert alert-warning" role="alert" *ngIf="showSelectUserAlert()">
      Select User.
    </div>
    <div class="alert alert-warning" role="alert" *ngIf="showUserChangeAlert()">
      Selecting another User will overwrite current data.
    </div>
  </div>
</div>

<hr />

<form [formGroup]="form">
  <formly-form [model]="record" [fields]="fields" [options]="options" [form]="form"></formly-form>
  <div class="alert alert-warning" role="alert" *ngIf="showOtherUserAlert()">
    Last actioned by: {{ record?.requestUserDTO?.updatedByDisplayName }}. Action buttons not available for other users.
  </div>
  <button type="button" class="btn btn-default" (click)="back()">Back</button>

  <button *ngIf="saveButton" (click)="submit()" class="btn btn-primary submit-button me-1" [disabled]="!form.dirty">
    Save
  </button>
  <button *ngIf="saveButton" type="button" class="btn btn-default" (click)="options.resetModel()">Undo</button>
  <app-confirmation-shell
    *ngIf="removeButton"
    [message]="'Remove Request: ' + recId + ' ?'"
    [labelText]="'Remove'"
    [responseValue]="recId"
    (response)="deleteRecord($event)"
  >
  </app-confirmation-shell>

  <app-confirmation-shell
    *ngIf="submitForApprovalButton"
    [message]="'Submit Request for Approval: ' + recId + ' ?'"
    [labelText]="'Submit For Approval'"
    [responseValue]="recId"
    (response)="submitForApproval()"
    [disabled]="!form.valid"
  >
  </app-confirmation-shell>

  <app-confirmation-shell
    *ngIf="withdrawRequestButton"
    [message]="'Withdraw submitted Request: ' + recId + ' ?'"
    [labelText]="'Withdraw submitted request'"
    [responseValue]="recId"
    (response)="withdrawRequest()"
  >
  </app-confirmation-shell>
</form>

<!-- <p>record: {{ record | json }}</p> -->

<!-- <p>showOtherUserAlert(): {{showOtherUserAlert()}}; -->

<!-- <p>currentUserIsLastUpdatedByUser: {{currentUserIsLastUpdatedByUser()}}</p> -->

<!-- <p>selecteduserId: {{selecteduserId}}</p>  -->

<!-- <p>userInfo: {{userInfo | json}}</p> -->

<!-- <p>invalid: {{invalidControls  | json}}</p> -->
